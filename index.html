<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Language Archive Collector — Tripod: Meaning‑Based AI‑Assisted OBT</title>

  <!-- Montserrat font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <!-- Masthead -->
  <div id="masthead" role="banner" aria-label="App title">
    <div class="masthead-inner">
      <img src="assets/logo-shema-white.png" alt="Shema logo" class="logo" />
      <div class="titles">
        <h1 class="app-title">Language Archive Collector</h1>
        <p class="app-subtitle">Ready Vessels Project for AI-Assisted OBT</p>
      </div>
    </div>
  </div>

  <!-- Sticky header: totals + actions -->
  <header id="app-header" role="toolbar" aria-label="Primary controls">
    <div class="header-inner">
      <div class="meta-block">
        <div class="clock-wrap">
          <span id="totalHours" class="clock">0h 00m</span>
          <span class="goal">/ 100h goal</span>
        </div>
        <div class="progress">
          <div id="progressFill" class="progress-fill" style="width:0%"></div>
        </div>
      </div>
      <div class="header-actions">
        <button id="newEntryBtn" class="btn primary">New Entry</button>
        <button id="saveEntryBtn" class="btn outline">Save Entry</button>
      </div>
    </div>
  </header>

  <!-- Section toolbar -->
  <div id="section-toolbar" role="region" aria-label="Section utilities">
    <div class="toolbar-inner">
      <div class="search-group">
        <input id="searchInput" type="search" placeholder="Search entries, tags, notes…" aria-label="Search" />
        <button id="clearSearchBtn" class="btn subtle" title="Clear search">Clear</button>
      </div>
      <div class="section-toggles">
        <button id="expandAllBtn" class="btn subtle">Expand all</button>
        <button id="collapseAllBtn" class="btn subtle">Collapse all</button>
      </div>
    </div>
  </div>

  <!-- Main content -->
  <main id="content">
    <!-- 1) Ideas & Themes (collapsed by default) -->
    <section class="pane" data-pane="ideas">
      <button class="pane-head" aria-expanded="false">
        <span>1) Ideas &amp; Themes</span><span class="chev">▸</span>
      </button>
      <div class="pane-body" style="display:none">
        <div class="ideas-grid">
          <aside class="genres">
            <h3>Genres (with hours)</h3>
            <ul id="genreList" class="genre-list" aria-live="polite"></ul>
          </aside>
          <div class="ideas-content">
            <div class="field-row">
              <label for="genreSelect">Select genre</label>
              <select id="genreSelect"></select>
            </div>
            <div class="field-row">
              <label for="promptSelect">Pick an idea / prompt</label>
              <select id="promptSelect"></select>
            </div>
            <button id="startWithPromptBtn" class="btn primary">Start with this prompt → Audio Capture</button>
          </div>
        </div>
      </div>
    </section>

    <!-- 2) Audio Capture (collapsed by default) -->
    <section class="pane" data-pane="audio">
      <button class="pane-head" aria-expanded="false">
        <span>2) Audio Capture</span><span class="chev">▸</span>
      </button>
      <div class="pane-body" style="display:none">
        <div class="audio-controls">
          <button id="recordBtn" class="btn primary">Record</button>
          <button id="pauseBtn" class="btn">Pause</button>
          <button id="resumeBtn" class="btn">Resume</button>
          <button id="stopBtn" class="btn danger">Stop</button>

          <input id="audioTitle" class="input" placeholder="Clip title (optional)" />
          <a id="downloadClip" class="btn outline" download="clip.webm" aria-disabled="true">Download</a>
          <button id="saveAudioIdBtn" class="btn outline">Save audio &amp; create Entry ID</button>

          <span id="recStatus" class="rec-status" aria-live="polite">Idle</span>
          <button id="uploadBtn" class="btn outline" type="button">Upload audio</button>
          <input id="uploadAudio" type="file" accept="audio/*" hidden />
        </div>

        <canvas id="waveform" height="84" aria-label="Waveform"></canvas>

        <div class="trim-controls">
          <label>Trim from (sec)
            <input id="trimStart" type="number" min="0" step="0.1" value="0">
          </label>
          <label>to (sec)
            <input id="trimEnd" type="number" min="0" step="0.1" value="0">
          </label>
          <button id="applyTrimBtn" class="btn">Apply trim</button>
        </div>

        <audio id="player" controls></audio>
      </div>
    </section>

    <!-- 3) Information (collapsed by default) -->
    <section class="pane" data-pane="meta">
      <button class="pane-head" aria-expanded="false">
        <span>3) Information</span><span class="chev">▸</span>
      </button>
      <div class="pane-body" style="display:none">

        <!-- Storyteller Information -->
        <h3 class="section-subhead">Storyteller</h3>
        <div class="grid-3">
          <div class="field">
            <label for="storytellerName">Storyteller name</label>
            <input id="storytellerName" placeholder="Full name" />
          </div>
          <div class="field">
            <label for="storytellerBirthplace">Place of birth</label>
            <input id="storytellerBirthplace" placeholder="City, region, country" />
          </div>
          <div class="field">
            <label for="storytellerGender">Gender</label>
            <select id="storytellerGender">
              <option value="">Choose…</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
            </select>
          </div>
          <div class="field">
            <label for="storytellerAge">Approximate age</label>
            <input id="storytellerAge" type="number" min="1" max="120" placeholder="Age in years" />
          </div>
          <div class="field">
            <label for="recorderName">Recorder name</label>
            <input id="recorderName" placeholder="Person recording this session" />
          </div>
          <div class="field">
            <label for="dateField">Date</label>
            <input id="dateField" type="date" />
          </div>
        </div>

        <!-- Consent Recording -->
        <h3 class="section-subhead">Consent Recording</h3>
        <div class="consent-block">
          <p class="consent-text">Please read aloud and record:</p>
          <blockquote class="consent-script">
            "I, <strong>[say your name]</strong>, give my voice to the Ready Vessels Project for Bible translation."
          </blockquote>
          <div class="consent-controls">
            <button id="consentRecordBtn" class="btn primary">Record Consent</button>
            <button id="consentStopBtn" class="btn danger">Stop</button>
            <span id="consentStatus" class="rec-status">No consent recorded</span>
          </div>
          <audio id="consentPlayer" controls></audio>
        </div>

        <!-- Language Information -->
        <h3 class="section-subhead">Language</h3>
        <div class="grid-3">
          <div class="field">
            <label for="languageName">Language name</label>
            <input id="languageName" placeholder="Name" />
          </div>
          <div class="field">
            <label for="languageCode">Language code</label>
            <input id="languageCode" placeholder="ISO / internal code" />
          </div>
          <div class="field">
            <label for="dialect">Dialect</label>
            <input id="dialect" placeholder="Dialect or region" />
          </div>
        </div>

        <!-- Entry Metadata -->
        <h3 class="section-subhead">Entry Details</h3>
        <div class="grid-3">
          <div class="field">
            <label for="entryId">Entry ID</label>
            <input id="entryId" placeholder="Will be auto‑generated when you save audio" />
          </div>
          <div class="field">
            <label for="styleSelect">Style</label>
            <select id="styleSelect">
              <option value="">Choose style…</option>
              <option>Conversational</option>
              <option>Ceremonial / Formal</option>
              <option>Teaching / Instruction</option>
              <option>Legal / Statute</option>
              <option>Religious / Worship</option>
              <option>Narrative storytelling</option>
              <option>Dialogue‑heavy</option>
              <option>Poetic</option>
              <option>Lament</option>
              <option>Praise / Hymn</option>
              <option>Proverb / Wisdom</option>
              <option>Other</option>
            </select>
          </div>
          <div class="field">
            <label for="genreMeta">Genre</label>
            <select id="genreMeta"></select>
          </div>
          <div class="field">
            <label for="registerSelect">Register</label>
            <select id="registerSelect">
              <option value="">Choose register…</option>
              <option>Casual conversation</option>
              <option>Ceremonial / formal</option>
              <option>Teaching / instructional</option>
              <option>Legal / formal</option>
              <option>Religious / worship</option>
              <option>Narrative storytelling</option>
              <option>Dialogue‑rich</option>
              <option>Poetic</option>
              <option>Other</option>
            </select>
          </div>
          <div class="field">
            <label for="settingSelect">Setting (where the story was told)</label>
            <select id="settingSelect">
              <option value="">Choose setting…</option>
              <option>Home</option>
              <option>Workplace</option>
              <option>Market / Village square</option>
              <option>Temple / Church</option>
              <option>School</option>
              <option>Field / Forest</option>
              <option>Waterfront / Shore</option>
              <option>Road / Travel</option>
              <option>Ceremony / Event</option>
              <option>Other</option>
            </select>
          </div>
          <div class="field">
            <label for="audienceSelect">Audience</label>
            <select id="audienceSelect">
              <option value="">Choose audience…</option>
              <option>Individual</option>
              <option>Family</option>
              <option>Children</option>
              <option>Elders</option>
              <option>Community</option>
              <option>Leaders</option>
              <option>Mixed group</option>
              <option>Other</option>
            </select>
          </div>
        </div>

        <!-- Story Summary -->
        <h3 class="section-subhead">Story Summary</h3>
        <div class="field full-width">
          <label for="storySummary">Summarize the story in one sentence</label>
          <input id="storySummary" placeholder="A brief description of what the story is about…" />
        </div>

        <!-- Export Outputs -->
        <h3 class="section-subhead">Export</h3>
        <div class="export-actions">
          <button id="exportAllBtn" class="btn primary">Export Audio + Metadata</button>
          <p class="muted">Downloads the story audio (.wav) and a JSON file with all metadata.</p>
        </div>

      </div>
    </section>

  </main>

  <!-- Footer -->
  <footer id="app-footer" role="contentinfo">
    <div class="footer-inner">
      <div class="footer-actions">
        <button id="themeToggle" class="btn">Dark / Light</button>
        <button id="clearFormBtn" class="btn danger">Clear Form</button>
      </div>
      <div class="org">© 2025 Shema Bible Translation, University of the Nations. YWAM Kansas City.</div>
    </div>
  </footer>

  <!-- Defer ensures DOM is parsed before JS runs on GitHub Pages -->
  <script src="./app.js" defer></script>
</body>
</html>
