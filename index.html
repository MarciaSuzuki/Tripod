<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Language Archive Collector ‚Äî Ideas First</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<header class="app-header">
  <div class="branding">
    <img src="logo.png" alt="Language Archive logo" class="logo">
    <div>
      <h1>Language Archive Collector</h1>
      <p class="tagline">Tripod: Meaning Based AI-Assisted OBT</p>
    </div>
  </div>
  <div class="toolbar">
    <button id="btnTheme" class="ghost" title="Toggle dark/light theme">üåô</button>
    <button id="btnNewEntry" class="primary">New Entry</button>
    <button id="btnSaveEntry" class="primary">Save Entry</button>
    <button id="btnRunQC">Run QC Checks</button>
    <button id="btnExportJSON">Export Entry (JSON)</button>
    <button id="btnExportCSV">Export Transcript (CSV)</button>
    <label class="import-label">
      Import Entry (JSON)
      <input type="file" id="importFile" accept="application/json">
    </label>
    <button id="btnClearForm" class="danger">Clear Form</button>
  </div>
</header>

<section class="goalbar">
  <div class="goalline">
    <span>Total collected:</span>
    <strong id="totalClock">00:00:00</strong>
    <span class="muted">/ 100:00:00 goal</span>
  </div>
  <div class="progress-wrap" role="progressbar" aria-valuemin="0" aria-valuemax="360000" aria-valuenow="0" aria-label="Hours collected towards 100h goal">
    <div id="progressBar" class="progress-bar" style="width:0%"></div>
  </div>
</section>

<section class="searchbar">
  <input id="searchInput" type="search" placeholder="Search entries by ID, language, speaker, collector, genre, or transcript text‚Ä¶" aria-label="Search entries">
  <button id="btnSearch">Search</button>
  <div class="search-actions">
    <button id="btnExpandAll" class="ghost">Expand all</button>
    <button id="btnCollapseAll" class="ghost">Collapse all</button>
  </div>
  <div id="searchResults" class="search-results" aria-live="polite"></div>
</section>

<main class="stack">
  <!-- 1 -->
  <details class="card accordion" data-key="sec1" open>
    <summary><span>1) Ideas & Themes</span></summary>
    <div class="content">
      <p class="muted">Pick a <strong>genre</strong> and an <strong>idea/prompt</strong> to elicit a natural story. Then click <em>Start with this prompt</em> to jump to Audio Capture. Clocks show total recorded hours per genre from your local archive.</p>
      <div class="ideas-toolbar">
        <button id="btnRecalcClocks" class="ghost">Refresh Clocks</button>
      </div>
      <div id="ideasList" class="ideas-list" aria-live="polite"></div>
      <p class="muted small">Tip: You can always switch prompts or record multiple short clips for the same idea.</p>
    </div>
  </details>

  <!-- 2 -->
  <details class="card accordion" data-key="sec2">
    <summary><span>2) Audio Capture</span></summary>
    <div class="content">
      <div class="idea-current muted">Theme: <span id="currentIdeaGenre">‚Äî</span> ‚Ä¢ Prompt: <span id="currentIdeaPrompt">‚Äî</span></div>
      <div class="recorder">
        <div class="record-controls">
          <button id="btnStartRec" class="record">‚óè Start</button>
          <button id="btnPauseRec" disabled>Pause</button>
          <button id="btnResumeRec" disabled>Resume</button>
          <button id="btnStopRec" disabled>‚ñ† Stop</button>
          <span id="recTimer" class="timer">00:00</span>
        </div>
        <div class="audio-preview">
          <audio id="audioPlayer" controls></audio>
          <div class="playback-tools">
            <label>Speed <input id="playbackRate" type="range" min="0.5" max="1.5" step="0.05" value="1"></label>
            <span id="playbackRateVal">1.00√ó</span>
          </div>
        </div>
        <div class="attach">
          <button id="btnAttachAudio" disabled>Attach to Entry</button>
          <label class="import-label small">
            Or upload audio
            <input type="file" id="audioUpload" accept="audio/*">
          </label>
        </div>
        <div class="hint">If your browser blocks recording, use ‚ÄúUpload audio‚Äù.</div>
      </div>

      <div class="waveform card-lite">
        <div class="wave-toolbar">
          <button id="btnShowWave">Show Waveform</button>
          <button id="btnZoomIn">Zoom +</button>
          <button id="btnZoomOut">Zoom ‚àí</button>
          <button id="btnClearSel">Clear Selection</button>
          <button id="btnTrimApply" class="danger">Trim to Selection (Replace)</button>
          <button id="btnDownloadSel">Download WAV (Selection)</button>
        </div>
        <canvas id="waveCanvas" width="900" height="140" aria-label="Audio waveform"></canvas>
        <div class="wave-meta">
          <div>Selection: <span id="selStart">0.000</span>s ‚Äì <span id="selEnd">0.000</span>s</div>
          <div>Duration: <span id="audDur">0.000</span>s ‚Ä¢ Zoom: <span id="zoomVal">1.0</span>√ó</div>
        </div>
      </div>
    </div>
  </details>

  <!-- 3 -->
  <details class="card accordion" data-key="sec3">
    <summary><span>3) Transcript & Tagging</span></summary>
    <div class="content">
      <div class="field-row">
        <label>Transcript (click and type; select text to tag)</label>
      </div>
      <div id="transcript" class="transcript" contenteditable="true" aria-label="Transcript editor"></div>
      <div class="tagging-tools">
        <div class="grid-2">
          <div>
            <label for="markerSelect">Add Marker to Selection</label>
            <select id="markerSelect"></select>
            <button id="btnAddMarker">Tag Selection</button>
            <button id="btnClearMarkers" class="danger">Clear All Markers</button>
          </div>
          <div>
            <label for="profileSelect">Select Profile (bundle)</label>
            <select id="profileSelect"></select>
            <button id="btnApplyProfile">Apply Profile Tags</button>
          </div>
        </div>
      </div>
      <details class="glossary">
        <summary>Marker Glossary</summary>
        <div class="glossary-controls">
          <input id="glossarySearch" type="search" placeholder="Filter markers‚Ä¶">
        </div>
        <div id="glossaryList" class="glossary-list" aria-live="polite"></div>
      </details>
    </div>
  </details>

  <!-- 4 -->
  <details class="card accordion" data-key="sec4">
    <summary><span>4) Entry & Language Metadata</span></summary>
    <div class="content">
      <div class="field-row">
        <label>Entry ID</label>
        <input id="entryId" type="text" placeholder="Auto-generated (click to regenerate)">
        <button id="btnGenId" class="small">Generate ID</button>
      </div>
      <div class="field-row">
        <label>Created At</label>
        <input id="createdAt" type="text" readonly>
      </div>
      <div class="grid-3">
        <div class="field">
          <label>Language Name<span class="req">*</span></label>
          <input id="langName" type="text" placeholder="e.g., Kaw√©ra">
        </div>
        <div class="field">
          <label>ISO 639-3 Code<span class="req">*</span></label>
          <input id="langCode" type="text" placeholder="e.g., xkw">
        </div>
        <div class="field">
          <label>Dialect / Variety<span class="req">*</span></label>
          <input id="langDialect" type="text" placeholder="e.g., Lower River">
        </div>
      </div>
      <div class="grid-3">
        <div class="field">
          <label>Genre<span class="req">*</span></label>
          <select id="genre">
            <option value="">‚Äî Select ‚Äî</option>
            <option>narrative</option>
            <option>song/hymn</option>
            <option>lament</option>
            <option>proverb</option>
            <option>procedural/instruction</option>
            <option>law/procedural</option>
            <option>genealogy/list</option>
            <option>prayer</option>
            <option>blessing/curse</option>
            <option>teaching/discourse</option>
            <option>disputation</option>
          </select>
        </div>
        <div class="field">
          <label>Register<span class="req">*</span></label>
          <select id="register">
            <option value="">‚Äî Select ‚Äî</option>
            <option>conversational</option>
            <option>ceremonial</option>
            <option>public address</option>
            <option>legal</option>
            <option>didactic</option>
          </select>
        </div>
        <div class="field">
          <label>Style<span class="req">*</span></label>
          <select id="style">
            <option value="">‚Äî Select ‚Äî</option>
            <option>solemn</option>
            <option>urgent</option>
            <option>legalistic</option>
            <option>direct</option>
            <option>reflective</option>
          </select>
        </div>
      </div>
    </div>
  </details>

  <!-- 5 -->
  <details class="card accordion" data-key="sec5">
    <summary><span>5) Performance Context</span></summary>
    <div class="content">
      <div class="grid-3">
        <div class="field">
          <label>Setting</label>
          <select id="setting">
            <option value="">‚Äî Select ‚Äî</option>
            <option>casual</option>
            <option>ceremonial</option>
          </select>
        </div>
        <div class="field">
          <label>Audience</label>
          <select id="audience">
            <option value="">‚Äî Select ‚Äî</option>
            <option>children</option>
            <option>youth</option>
            <option>adults</option>
            <option>mixed</option>
          </select>
        </div>
        <div class="field">
          <label>Participation</label>
          <select id="participation">
            <option value="">‚Äî Select ‚Äî</option>
            <option>solo</option>
            <option>responsive</option>
            <option>call-and-response</option>
          </select>
        </div>
      </div>
      <div class="field-row">
        <label>Social Constraints / Notes</label>
        <input id="socialConstraints" type="text" placeholder="e.g., honorifics for elders; large crowd">
      </div>
    </div>
  </details>

  <!-- 6 -->
  <details class="card accordion" data-key="sec6">
    <summary><span>6) Contributors & Consent</span></summary>
    <div class="content">
      <div class="grid-2">
        <div class="field">
          <label>Speaker (pseudonym)</label>
          <input id="speakerName" type="text" placeholder="e.g., Maya-K">
        </div>
        <div class="field">
          <label>Speaker Profile</label>
          <input id="speakerProfile" type="text" placeholder="e.g., F, ~62, respected grandmother">
        </div>
      </div>
      <div class="grid-2">
        <div class="field">
          <label>Collector</label>
          <input id="collector" type="text" placeholder="Your name / team">
        </div>
        <div class="field">
          <label>Consent Level</label>
          <select id="consent">
            <option value="">‚Äî Select ‚Äî</option>
            <option>public</option>
            <option>project-internal</option>
            <option>team-only</option>
          </select>
        </div>
      </div>
    </div>
  </details>

  <!-- 7 -->
  <details class="card accordion" data-key="sec7">
    <summary><span>7) QC Checks</span></summary>
    <div class="content">
      <div id="qcPanel" class="qc-panel">
        <p class="muted">Click ‚ÄúRun QC Checks‚Äù in the top toolbar to evaluate this entry.</p>
      </div>
    </div>
  </details>
</main>

<footer class="app-footer">
  <div><strong>Notes:</strong> Entries are saved locally (IndexedDB). Export JSON/CSV often. ‚Äî Theme: <span id="themeLabel">dark</span></div>
</footer>

<script src="app.js"></script>
</body>
</html>
